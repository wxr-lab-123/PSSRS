<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hjm.mapper.UserMapper">

    <!-- 查询医生列表（分页） -->
    <select id="listUsers" resultType="com.hjm.pojo.VO.DoctorVO">
        SELECT
        u.id,
        u.name,
        u.phone,
        u.gender,
        u.status,
        dp.title,
        dp.description,
        dp.image,
        d.name AS departmentName
        FROM user u
        LEFT JOIN doctor_profile dp ON dp.user_id = u.id
        LEFT JOIN department d ON d.id = dp.department_id
        JOIN user_role ure ON ure.user_id = u.id
        JOIN role r ON ure.role_id = r.id
        WHERE u.is_deleted = 0
        AND r.role_name = 'DOCTOR'

        <if test="name != null and name != ''">
            AND u.name LIKE CONCAT('%', #{name}, '%')
        </if>

        <if test="departmentId != null">
            AND dp.department_id = #{departmentId}
        </if>

        ORDER BY u.create_time DESC
    </select>



    <!-- 查询管理员列表（分页） -->
    <select id="listAdmins" resultType="com.hjm.pojo.VO.DoctorVO">
        SELECT
            u.id,
            u.name,
            u.phone,
            u.gender,
            u.status
        FROM user u
        INNER JOIN user_role ur ON u.id = ur.user_id
        INNER JOIN role r ON ur.role_id = r.id
        WHERE r.role_name = 'ADMIN'
        AND u.is_deleted = 0
        <if test="name != null and name != ''">
            AND u.name LIKE CONCAT('%', #{name}, '%')
        </if>
        ORDER BY u.create_time DESC
    </select>

</mapper>
