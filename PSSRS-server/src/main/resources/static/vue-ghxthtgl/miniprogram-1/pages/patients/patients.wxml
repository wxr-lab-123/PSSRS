<navigation-bar title="å°±è¯Šäººç®¡ç†" back="{{true}}"></navigation-bar>
<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <view class="header">
      <button class="add-btn" bindtap="openAdd">+ æ·»åŠ å°±è¯Šäºº</button>
    </view>
    
    <view wx:if="{{patients.length===0}}" class="empty">
      <view class="empty-img">ğŸ“‹</view>
      <text class="empty-text">æš‚æ— å°±è¯Šäººï¼Œè¯·æ·»åŠ </text>
    </view>
    
    <view wx:else>
      <block wx:for="{{patients}}" wx:key="id">
        <view class="card">
          <view class="card-header">
            <view class="name-wrapper">
              <text class="name">{{item.name}}</text>
              <text class="tag">{{item.relation || 'å®¶å±'}}</text>
            </view>
          </view>
          
          <view class="card-body">
            <view class="info-row">
              <text class="label">èº«ä»½è¯</text>
              <text class="value">{{item.idCardMasked || '-'}}</text>
            </view>
            <view class="info-row">
              <text class="label">æ‰‹æœºå·</text>
              <text class="value">{{item.phone || '-'}}</text>
            </view>
            <view class="info-row">
              <text class="label">æ€§åˆ«/å¹´é¾„</text>
              <text class="value">{{item.genderText}} / {{item.age ? item.age + 'å²' : '-'}}</text>
            </view>
          </view>
          
          <view class="actions">
            <button class="btn-action btn-edit" bindtap="openEdit" data-item="{{item}}">ç¼–è¾‘</button>
            <button class="btn-action btn-delete" bindtap="remove" data-id="{{item.id}}">åˆ é™¤</button>
          </view>
        </view>
      </block>
    </view>
  </view>
</scroll-view>

<view class="modal {{showForm ? 'show' : ''}}" catchtouchmove="true" bindtap="closeForm">
    <view class="modal-body" catchtap="stop">
      <view class="modal-title">{{isEdit ? 'ç¼–è¾‘å°±è¯Šäºº' : 'æ·»åŠ å°±è¯Šäºº'}}</view>
      
      <view class="form-item">
        <text class="form-label">å§“å</text>
        <input class="input-box {{isEdit ? 'disabled' : ''}}" placeholder="è¯·è¾“å…¥çœŸå®å§“å" placeholder-class="ph" value="{{form.name}}" bindinput="onInput" data-key="name" disabled="{{isEdit}}"/>
      </view>
      
      <view class="form-item">
        <text class="form-label">èº«ä»½è¯å·</text>
        <input class="input-box {{isEdit ? 'disabled' : ''}}" type="idcard" placeholder="è¯·è¾“å…¥èº«ä»½è¯å·" placeholder-class="ph" value="{{form.idCard}}" bindinput="onInput" data-key="idCard" maxlength="18" disabled="{{isEdit}}"/>
      </view>
      
      <view class="form-item">
        <text class="form-label">æ‰‹æœºå·</text>
        <input class="input-box" type="number" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" placeholder-class="ph" value="{{form.phone}}" bindinput="onInput" data-key="phone" maxlength="11"/>
      </view>

      <view class="form-item">
        <text class="form-label">éªŒè¯ç </text>
        <view class="verify-row">
          <input class="input-box verify-input" type="number" placeholder="è¯·è¾“å…¥éªŒè¯ç " placeholder-class="ph" value="{{form.code}}" bindinput="onInput" data-key="code" maxlength="6"/>
          <button class="verify-btn {{isCountingDown ? 'disabled' : ''}}" bindtap="getVerificationCode" disabled="{{isCountingDown}}">{{countdownText}}</button>
        </view>
      </view>
      
      <view class="form-item">
        <text class="form-label">å…³ç³»</text>
        <radio-group bindchange="onRelationChange" class="radio-group">
          <label class="radio-label"><radio class="radio-item" value="æœ¬äºº" checked="{{form.relation==='æœ¬äºº'}}" color="#1e90ff"/>æœ¬äºº</label>
          <label class="radio-label"><radio class="radio-item" value="å®¶äºº" checked="{{form.relation==='å®¶äºº' || form.relation==='å®¶å±'}}" color="#1e90ff"/>å®¶äºº</label>
          <label class="radio-label"><radio class="radio-item" value="æœ‹å‹" checked="{{form.relation==='æœ‹å‹'}}" color="#1e90ff"/>æœ‹å‹</label>
          <label class="radio-label"><radio class="radio-item" value="å…¶ä»–" checked="{{form.relation==='å…¶ä»–'}}" color="#1e90ff"/>å…¶ä»–</label>
        </radio-group>
      </view>
      
      <view class="modal-footer">
        <button class="modal-btn btn-cancel" bindtap="closeForm">å–æ¶ˆ</button>
        <button class="modal-btn btn-save" bindtap="save">ä¿å­˜</button>
      </view>
    </view>
  </view>
