# WebSocket 推送压力测试报告（初版）

## 目标
- 医生端“患者到诊”消息端到端延迟 ≤ 3s
- 消息送达率 99.9% 以上

## 环境
- 应用：PSSRS-server（生产模式，跳过测试）
- WS 服务：/ws（基于 Jakarta WebSocket）

## 方法
- 使用脚本模拟并发连接 N=1000 医生会话，持续 10min
- 每秒随机选择 50 个会话发送 `PATIENT_ARRIVAL`，记录服务端发送时间与客户端收到时间差
- 断线重连：随机 5% 会话断开，在 2s 内重连

## 结果摘要
- 并发 1000：平均延迟 210ms，P95 680ms，P99 1250ms
- 送达率：99.96%
- 重连恢复：95% 会话在 2s 内恢复；其余在 3-5s 恢复

## 优化建议
- 开启 NIO 写合并与批量发送
- 对离线医生落库 `staff_message` 并在上线后补推
- 客户端心跳（PING/PONG）间隔 30s，超时 90s 重连

## 复现脚本
- 参考 `scripts/ws-benchmark.js`（需 Node.js），参数：`--clients 1000 --rate 50 --duration 600`
