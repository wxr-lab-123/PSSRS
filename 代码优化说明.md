# 医生和管理员代码结构优化说明

## 优化概述

本次优化保持了原有的数据库设计（User + Role + DoctorProfile），通过代码层面的优化使医生和管理员的管理更加清晰和规范。

## 优化内容

### 1. 常量定义优化 (`MyConstant.java`)

**新增内容：**
- `ROLE_ADMIN_ID = 1L` - 管理员角色ID
- `ROLE_DOCTOR_ID = 2L` - 医生角色ID
- `ROLE_ADMIN_NAME = "ADMIN"` - 管理员角色名称
- `ROLE_DOCTOR_NAME = "DOCTOR"` - 医生角色名称

**作用：** 统一管理角色相关常量，避免硬编码。

---

### 2. 创建专门的DTO

#### DoctorDTO.java
用于医生注册和更新的数据传输对象，包含：
- 基础信息：用户名、手机号、性别、状态
- 医生专属信息：职称、科室ID、简介、头像

#### AdminDTO.java
用于管理员注册和更新的数据传输对象，包含：
- 基础信息：用户名、姓名、手机号、性别、状态

**作用：** 明确区分医生和管理员的数据结构，提高代码可读性。

---

### 3. Service层优化 (`IUserService` & `UserServiceImpl`)

#### 新增方法：

**医生相关：**
- `registerDoctor(DoctorDTO)` - 注册医生账号
- `listDoctors(name, departmentId, page, pageSize)` - 查询医生列表
- `updateDoctor(userId, DoctorDTO)` - 更新医生信息

**管理员相关：**
- `registerAdmin(AdminDTO)` - 注册管理员账号
- `listAdmins(name, page, pageSize)` - 查询管理员列表
- `updateAdmin(userId, AdminDTO)` - 更新管理员信息

**通用方法：**
- `deleteUser(userId)` - 删除用户（软删除）

**作用：** 通过方法名明确区分业务场景，提高代码可维护性。

---

### 4. Controller层优化 (`UserController`)

#### API接口分类：

**医生管理接口：**
- `POST /api/admin/doctors` - 注册医生
- `GET /api/admin/doctors` - 查询医生列表
- `PUT /api/admin/doctors/{userId}` - 更新医生信息

**管理员管理接口：**
- `POST /api/admin/admins` - 注册管理员
- `GET /api/admin/admins` - 查询管理员列表
- `PUT /api/admin/admins/{userId}` - 更新管理员信息

**通用接口：**
- `DELETE /api/admin/users/{userId}` - 删除用户

**作用：** RESTful风格的API设计，路径清晰，易于前端调用。

---

### 5. Mapper层优化

#### UserMapper.java
新增方法：
- `listUsers(page, name, departmentId)` - 查询医生列表
- `listAdmins(page, name)` - 查询管理员列表

#### UserMapper.xml
实现SQL查询：
- 医生列表查询：关联 `user`、`user_role`、`role`、`doctor_profile`、`department` 表
- 管理员列表查询：关联 `user`、`user_role`、`role` 表

**作用：** 通过角色名称（ADMIN/DOCTOR）区分查询，支持分页和条件筛选。

---

## 数据库设计说明

### 表结构关系

```
User (用户基础表)
  ├─ id, username, password, name, phone, gender, status
  └─ create_time, update_time, is_deleted

UserRole (用户角色关联表)
  ├─ user_id → User.id
  └─ role_id → Role.id

Role (角色表)
  ├─ id (1=ADMIN, 2=DOCTOR)
  └─ role_name (ADMIN/DOCTOR)

DoctorProfile (医生扩展信息表，仅医生有)
  ├─ user_id → User.id
  ├─ title (职称)
  ├─ department_id → Department.id
  ├─ description (简介)
  └─ image (头像)
```

### 设计优势

1. **灵活性**：一个用户可以拥有多个角色
2. **扩展性**：未来添加新角色（如护士、药剂师）只需添加角色记录
3. **规范性**：符合RBAC（基于角色的访问控制）设计模式
4. **避免冗余**：医生和管理员共享基础字段，减少数据重复

---

## 使用示例

### 注册医生
```java
POST /api/admin/doctors
{
  "username": "doctor001",
  "phone": "13800138000",
  "gender": "0",
  "status": 1,
  "title": "主任医师",
  "departmentId": 1,
  "description": "擅长心血管疾病治疗",
  "image": "http://example.com/avatar.jpg"
}
```

### 注册管理员
```java
POST /api/admin/admins
{
  "username": "admin001",
  "name": "张三",
  "phone": "13900139000",
  "gender": "0",
  "status": 1
}
```

### 查询医生列表
```java
GET /api/admin/doctors?name=张&departmentId=1&page=1&pageSize=10
```

### 查询管理员列表
```java
GET /api/admin/admins?name=李&page=1&pageSize=10
```

---

## 注意事项

1. **默认密码**：新注册的用户使用 `PasswordConstant.DEFAULT_PASSWORD` 作为默认密码
2. **软删除**：删除用户时设置 `is_deleted=1`，不物理删除数据
3. **事务管理**：注册和更新操作使用 `@Transactional` 保证数据一致性
4. **角色分配**：
   - 医生注册时自动分配 `ROLE_DOCTOR_ID`
   - 管理员注册时自动分配 `ROLE_ADMIN_ID`

---

## 总结

本次优化通过代码层面的重构，在保持数据库设计不变的前提下，实现了医生和管理员的清晰分离：

✅ **保持了原有的RBAC设计模式**  
✅ **提高了代码的可读性和可维护性**  
✅ **API接口更加清晰和RESTful**  
✅ **为未来扩展新角色预留了空间**

这种设计既满足了当前需求，又保证了系统的灵活性和扩展性。
